<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Catawba ‚Üí ‚ÄúCheraw-accent‚Äù Pronunciation Trainer</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background:#f6f7f9; }
    header { padding: 16px; background:#111827; color:white; }
    main { padding: 16px; max-width: 1040px; margin: 0 auto; }
    .row { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 960px){ .row { grid-template-columns: 1.35fr .65fr; } }
    .card { background:white; border-radius: 16px; padding: 16px; box-shadow: 0 8px 20px rgba(0,0,0,.06); }
    .pill { display:inline-block; padding: 6px 10px; border-radius: 999px; background:#eef2ff; }
    .big { font-size: 28px; font-weight: 760; margin: 8px 0; }
    .label { font-size: 12px; text-transform: uppercase; letter-spacing: .08em; color:#6b7280; }
    .muted { color:#6b7280; }
    .small { font-size: 13px; }
    button { border: 0; border-radius: 12px; padding: 10px 12px; cursor:pointer; font-weight: 650; }
    button.primary { background:#111827; color:white; }
    button.secondary { background:#e5e7eb; }
    button.warn { background:#fee2e2; }
    button:disabled { opacity:.55; cursor:not-allowed; }
    .btns { display:flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
    select, input { width: 100%; padding: 10px 12px; border-radius: 12px; border: 1px solid #e5e7eb; }
    .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .grid3 { display:grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
    .hr { height:1px; background:#e5e7eb; margin: 12px 0; }

    .syllables { display:flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
    .syll { padding: 8px 10px; border-radius: 999px; background:#f3f4f6; border: 1px solid #e5e7eb; }
    .syll:hover { filter: brightness(.98); }
    .syll:active { transform: scale(.98); }

    .toggleRow { display:flex; gap: 10px; align-items:center; flex-wrap: wrap; }
    .toggle { display:flex; gap: 8px; align-items:center; }
    .toggle input { width: 18px; height: 18px; }
    .range { width:100%; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    audio { width:100%; }
  </style>
</head>
<body>
  <header>
    <div style="max-width:1040px;margin:0 auto;">
      <div style="font-weight:850;">Pronunciation Trainer</div>
      <div class="small" style="opacity:.85;">
        Catawba words + ‚ÄúCheraw-accent‚Äù teaching approximations (not attested Cheraw forms).
      </div>
    </div>
  </header>

  <main>
    <div class="row">
      <section class="card">
        <div class="label">Mode / Search</div>

        <div class="grid3" style="margin-top:8px;">
          <div>
            <select id="mode">
              <option value="catawba">Catawba (as written)</option>
              <option value="cheraw_con">‚ÄúCheraw-accent‚Äù (Conservative)</option>
              <option value="cheraw_soft">‚ÄúCheraw-accent‚Äù (Soft/Lenited)</option>
            </select>
          </div>
          <div>
            <input id="search" placeholder="Search (e.g., red, father, one)..." />
          </div>
          <div>
            <select id="voice"></select>
          </div>
        </div>

        <div class="toggleRow" style="margin-top:10px;">
          <div class="toggle">
            <input type="checkbox" id="showIpa" checked />
            <label for="showIpa" class="small">Show IPA</label>
          </div>
          <div style="flex:1; min-width: 220px;">
            <div class="label">Slow-mode pause (ms)</div>
            <input id="pauseMs" class="range" type="range" min="150" max="1200" step="50" value="450" />
            <div class="small muted"><span id="pauseLabel">450</span> ms between syllables</div>
          </div>
          <div style="flex:1; min-width: 220px;">
            <div class="label">Speech rate</div>
            <input id="rate" class="range" type="range" min="0.6" max="1.1" step="0.05" value="0.85" />
            <div class="small muted">Rate: <span id="rateLabel">0.85</span></div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="pill" id="categoryPill">Colors</div>
        <div class="big" id="english">red</div>

        <div class="label">Word</div>
        <div class="big" id="word">aÃ£ îurv te</div>

        <div class="label">Pronunciation guide</div>
        <div class="big" id="pron">ah-chew-teh</div>

        <div id="ipaWrap">
          <div class="label">IPA</div>
          <div class="big mono" id="ipa">/…ë tÕ° Éu t…õ/</div>
        </div>

        <div class="label">Tap a syllable</div>
        <div class="syllables" id="syllables"></div>

        <div class="label" style="margin-top:12px;">Coaching tip</div>
        <div class="muted" id="tip">Keep syllables clean: ah / chew / teh.</div>

        <div class="btns">
          <button class="secondary" id="prev">‚óÄ Prev</button>
          <button class="secondary" id="next">Next ‚ñ∂</button>
          <button class="primary" id="speak">üîä Speak (full)</button>
          <button class="primary" id="slow">üê¢ Slow mode</button>
          <button class="secondary" id="stopTts">‚èπ Stop</button>
        </div>

        <div class="hr"></div>

        <div class="label">Practice recorder</div>
        <div class="muted small">Record yourself, then compare to the syllables / slow mode.</div>
        <div class="btns">
          <button class="primary" id="rec">‚óè Record</button>
          <button class="warn" id="stopRec" disabled>‚ñ† Stop</button>
        </div>
        <audio id="playback" controls></audio>
      </section>

      <aside class="card">
        <div class="label">How to use</div>
        <ul class="small">
          <li>Use <b>Tap a syllable</b> to drill one piece at a time.</li>
          <li>Use <b>Slow mode</b> to hear syllables separated with a pause.</li>
          <li>Toggle <b>Show IPA</b> if you want phonetic precision.</li>
          <li>Pick a voice that sounds clearest; slow the rate for beginners.</li>
        </ul>

        <div class="hr"></div>
        <div class="label">Dataset note</div>
        <div class="small muted">
          IPA is optional per entry. If you leave it blank, the app displays ‚Äú‚Äî‚Äù.
          Best practice is to eventually replace TTS with community-approved recordings.
        </div>
      </aside>
    </div>
  </main>

<script>
  // === PASTE YOUR EXPANDED DATASET HERE ===
  // Add optional IPA fields: c_ipa, con_ipa, soft_ipa (strings like "/.../").
  // Example entry:
  // { cat:"Colors", english:"red", c_word:"aÃ£ îurv te", c_pron:"ah-chew-teh", c_ipa:"/…ë tÕ° Éu t…õ/",
  // con_word:"aÃ£ îurv te", con_pron:"ah-chew-teh", con_ipa:"/…ë tÕ° Éu t…õ/",
  // soft_word:"aÃ£ îurv te", soft_pron:"uh-chew-deh", soft_ipa:"/…ô tÕ° Éu d…õ/",
  // tip:"..." }

  const DATA = [
    // Minimal examples so the file runs even before you paste the full dataset:
    { cat:"Colors", english:"red", c_word:"aÃ£ îurv te", c_pron:"ah-chew-teh", c_ipa:"/…ë tÕ° Éu t…õ/",
      con_word:"aÃ£ îurv te", con_pron:"ah-chew-teh", con_ipa:"/…ë tÕ° Éu t…õ/",
      soft_word:"aÃ£ îurv te", soft_pron:"uh-chew-deh", soft_ipa:"/…ô tÕ° Éu d…õ/",
      tip:"Three clean syllables: ah / chew / teh." },

    { cat:"Numbers", english:"two", c_word:"nurpa", c_pron:"new-pah", c_ipa:"/nu p…ë/",
      con_word:"nurpa", con_pron:"new-pah", con_ipa:"/nu p…ë/",
      soft_word:"nurpa", soft_pron:"nuh-bah", soft_ipa:"/n…ô b…ë/",
      tip:"In soft mode, p may feel closer to b." },
  ];
  // === END DATA ===

  let idx = 0;
  let filtered = DATA;

  const el = (id) => document.getElementById(id);
  const mode = el("mode");
  const search = el("search");
  const showIpa = el("showIpa");
  const ipaWrap = el("ipaWrap");
  const pauseMs = el("pauseMs");
  const pauseLabel = el("pauseLabel");
  const rate = el("rate");
  const rateLabel = el("rateLabel");
  const voiceSel = el("voice");

  pauseLabel.textContent = pauseMs.value;
  rateLabel.textContent = rate.value;

  pauseMs.oninput = () => pauseLabel.textContent = pauseMs.value;
  rate.oninput = () => rateLabel.textContent = rate.value;

  function currentEntry(){ return filtered[idx] || filtered[0]; }

  function getFields(entry){
    if (mode.value === "catawba") return { word: entry.c_word, pron: entry.c_pron, ipa: entry.c_ipa || "‚Äî" };
    if (mode.value === "cheraw_con") return { word: entry.con_word, pron: entry.con_pron, ipa: entry.con_ipa || "‚Äî" };
    return { word: entry.soft_word, pron: entry.soft_pron, ipa: entry.soft_ipa || "‚Äî" };
  }

  function splitSyllables(pron){
    // Split on hyphens and trim whitespace
    return pron.split("-").map(s => s.trim()).filter(Boolean);
  }

  // ---- TTS helpers ----
  let voices = [];
  function loadVoices(){
    voices = window.speechSynthesis ? speechSynthesis.getVoices() : [];
    voiceSel.innerHTML = "";
    if (!voices.length) {
      const opt = document.createElement("option");
      opt.value = "";
      opt.textContent = "No voices available";
      voiceSel.appendChild(opt);
      return;
    }
    // Prefer English voices; still allow all.
    const preferred = voices.slice().sort((a,b) => {
      const ae = (a.lang || "").toLowerCase().startsWith("en") ? 0 : 1;
      const be = (b.lang || "").toLowerCase().startsWith("en") ? 0 : 1;
      return ae - be;
    });
    preferred.forEach((v,i) => {
      const opt = document.createElement("option");
      opt.value = v.name;
      opt.textContent = `${v.name} (${v.lang})`;
      voiceSel.appendChild(opt);
    });
  }
  if ("speechSynthesis" in window) {
    loadVoices();
    speechSynthesis.onvoiceschanged = loadVoices;
  }

  function speakText(text){
    if (!("speechSynthesis" in window)) {
      alert("Speech synthesis not supported in this browser.");
      return;
    }
    speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.rate = parseFloat(rate.value);
    // Pick selected voice if possible
    const pick = voices.find(v => v.name === voiceSel.value);
    if (pick) u.voice = pick;
    speechSynthesis.speak(u);
  }

  function stopTts(){
    if ("speechSynthesis" in window) speechSynthesis.cancel();
  }

  async function slowSpeakSyllables(syllables){
    stopTts();
    const pause = parseInt(pauseMs.value, 10);
    for (const s of syllables) {
      speakText(s.replaceAll("‚Äô", "'"));
      // wait until current utterance ends + pause
      await waitForSpeechEnd();
      await sleep(pause);
    }
  }

  function waitForSpeechEnd(){
    return new Promise((resolve) => {
      if (!("speechSynthesis" in window)) return resolve();
      const check = () => {
        if (!speechSynthesis.speaking && !speechSynthesis.pending) return resolve();
        setTimeout(check, 30);
      };
      check();
    });
  }

  function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

  // ---- Render ----
  function renderSyllableButtons(syllables){
    const wrap = el("syllables");
    wrap.innerHTML = "";
    syllables.forEach((sy) => {
      const b = document.createElement("button");
      b.className = "syll";
      b.type = "button";
      b.textContent = sy;
      b.onclick = () => speakText(sy);
      wrap.appendChild(b);
    });
  }

  function render(){
    if (!filtered.length) {
      el("categoryPill").textContent = "No results";
      el("english").textContent = "‚Äî";
      el("word").textContent = "‚Äî";
      el("pron").textContent = "‚Äî";
      el("ipa").textContent = "‚Äî";
      el("syllables").innerHTML = "";
      el("tip").textContent = "Try another search term.";
      return;
    }
    const e = currentEntry();
    const f = getFields(e);

    el("categoryPill").textContent = e.cat;
    el("english").textContent = e.english;
    el("word").textContent = f.word;
    el("pron").textContent = f.pron;

    ipaWrap.style.display = showIpa.checked ? "block" : "none";
    el("ipa").textContent = f.ipa || "‚Äî";

    const sylls = splitSyllables(f.pron);
    renderSyllableButtons(sylls);

    el("tip").textContent = e.tip || "";
  }

  // ---- Navigation ----
  el("prev").onclick = () => { if (!filtered.length) return; idx = (idx - 1 + filtered.length) % filtered.length; render(); };
  el("next").onclick = () => { if (!filtered.length) return; idx = (idx + 1) % filtered.length; render(); };

  // Speak full
  el("speak").onclick = () => {
    const pron = el("pron").textContent;
    // Replace hyphens with spaces so TTS doesn't pause strangely mid-word
    speakText(pron.replaceAll("-", " "));
  };

  // Slow mode
  el("slow").onclick = async () => {
    const pron = el("pron").textContent;
    const sylls = splitSyllables(pron);
    await slowSpeakSyllables(sylls);
  };

  el("stopTts").onclick = stopTts;

  mode.onchange = render;
  showIpa.onchange = render;

  search.oninput = () => {
    const q = search.value.trim().toLowerCase();
    filtered = !q ? DATA : DATA.filter(d =>
      (d.english || "").toLowerCase().includes(q) ||
      (d.cat || "").toLowerCase().includes(q) ||
      (d.c_word || "").toLowerCase().includes(q) ||
      (d.c_pron || "").toLowerCase().includes(q) ||
      (d.con_word || "").toLowerCase().includes(q) ||
      (d.con_pron || "").toLowerCase().includes(q) ||
      (d.soft_word || "").toLowerCase().includes(q) ||
      (d.soft_pron || "").toLowerCase().includes(q)
    );
    idx = 0;
    render();
  };

  // ---- Recorder ----
  let mediaRecorder = null;
  let chunks = [];

  el("rec").onclick = async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      chunks = [];
      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.ondataavailable = (e) => chunks.push(e.data);
      mediaRecorder.onstop = () => {
        const blob = new Blob(chunks, { type: "audio/webm" });
        el("playback").src = URL.createObjectURL(blob);
      };
      mediaRecorder.start();
      el("rec").disabled = true;
      el("stopRec").disabled = false;
    } catch (err) {
      alert("Microphone permission is required to record.");
    }
  };

  el("stopRec").onclick = () => {
    if (mediaRecorder && mediaRecorder.state !== "inactive") {
      mediaRecorder.stop();
      el("rec").disabled = false;
      el("stopRec").disabled = true;
    }
  };

  render();
</script>
</body>
</html>